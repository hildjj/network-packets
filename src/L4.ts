import {type ICMP, ICMP_PROTO, readICMP} from './icmp.ts';
import {type ICMP6, ICMP6_PROTO, readICMP6} from './icmp6.ts';
import {type TCP, TCP_PROTO, readTCP} from './tcp.ts';
import {type UDP, UDP_PROTO, readUDP} from './udp.ts';
import type {DataViewReader} from 'dataview-stream';
import type {PartialTyped} from './types.ts';

export type L4 = TCP | UDP | ICMP | ICMP6 | Uint8Array;
export type TruncatedL4 =
  PartialTyped<TCP> |
  PartialTyped<UDP> |
  PartialTyped<ICMP> |
  PartialTyped<ICMP6> |
  Uint8Array;

export const L4_DECODERS = new Map<number | string, (r: DataViewReader) => L4>([
  [TCP_PROTO, readTCP],
  [UDP_PROTO, readUDP],
  [ICMP_PROTO, readICMP],
  [ICMP6_PROTO, readICMP6],
]);

export const L4_PROTOCOLS = new Map([
  [0, 'ip'],
  [1, 'icmp'],
  [2, 'igmp'],
  [3, 'ggp'],
  [4, 'ipencap'],
  [5, 'st2'],
  [6, 'tcp'],
  [7, 'cbt'],
  [8, 'egp'],
  [9, 'igp'],
  [10, 'bbn_rcc'],
  [11, 'nvp'],
  [12, 'pup'],
  [13, 'argus'],
  [14, 'emcon'],
  [15, 'xnet'],
  [16, 'chaos'],
  [17, 'udp'],
  [18, 'mux'],
  [19, 'dcn'],
  [20, 'hmp'],
  [21, 'prm'],
  [22, 'xns_idp'],
  [23, 'trunk_1'],
  [24, 'trunk_2'],
  [25, 'leaf_1'],
  [26, 'leaf_2'],
  [27, 'rdp'],
  [28, 'irtp'],
  [29, 'iso_tp4'],
  [30, 'netblt'],
  [31, 'mfe_nsp'],
  [32, 'merit_inp'],
  [33, 'dccp'],
  [34, 'threepc'],
  [35, 'idpr'],
  [36, 'xtp'],
  [37, 'ddp'],
  [38, 'idpr_cmtp'],
  [39, 'tppp'],
  [40, 'il'],
  [41, 'ipv6'],
  [42, 'sdrp'],
  [43, 'ipv6_route'],
  [44, 'ipv6_frag'],
  [45, 'idrp'],
  [46, 'rsvp'],
  [47, 'gre'],
  [48, 'dsr'],
  [49, 'bna'],
  [50, 'esp'],
  [51, 'ah'],
  [52, 'i_nlsp'],
  [53, 'swipe'],
  [54, 'narp'],
  [55, 'mobile'],
  [56, 'tlsp'],
  [57, 'skip'],
  [58, 'ipv6_icmp'],
  [59, 'ipv6_nonxt'],
  [60, 'ipv6_opts'],
  [62, 'cftp'],
  [64, 'sat_expak'],
  [65, 'kryptolan'],
  [66, 'rvd'],
  [67, 'ippc'],
  [69, 'sat_mon'],
  [70, 'visa'],
  [71, 'ipcv'],
  [72, 'cpnx'],
  [73, 'cphb'],
  [74, 'wsn'],
  [75, 'pvp'],
  [76, 'br_sat_mon'],
  [77, 'sun_nd'],
  [78, 'wb_mon'],
  [79, 'wb_expak'],
  [80, 'iso_ip'],
  [81, 'vmtp'],
  [82, 'secure_vmtp'],
  [83, 'vines'],
  [84, 'ttp'],
  [85, 'nsfnet_igp'],
  [86, 'dgp'],
  [87, 'tcf'],
  [88, 'eigrp'],
  [89, 'ospf'],
  [90, 'sprite_rpc'],
  [91, 'larp'],
  [92, 'mtp'],
  [93, 'ax_25'],
  [94, 'ipip'],
  [95, 'micp'],
  [96, 'scc_sp'],
  [97, 'etherip'],
  [98, 'encap'],
  [100, 'gmtp'],
  [101, 'ifmp'],
  [102, 'pnni'],
  [103, 'pim'],
  [104, 'aris'],
  [105, 'scps'],
  [106, 'qnx'],
  [107, 'a_n'],
  [108, 'ipcomp'],
  [109, 'snp'],
  [110, 'compaq_peer'],
  [111, 'ipx_in_ip'],
  [112, 'carp'],
  [113, 'pgm'],
  [115, 'l2tp'],
  [116, 'ddx'],
  [117, 'iatp'],
  [118, 'stp'],
  [119, 'srp'],
  [120, 'uti'],
  [121, 'smp'],
  [122, 'sm'],
  [123, 'ptp'],
  [124, 'isis'],
  [125, 'fire'],
  [126, 'crtp'],
  [127, 'crudp'],
  [128, 'sscopmce'],
  [129, 'iplt'],
  [130, 'sps'],
  [131, 'pipe'],
  [132, 'sctp'],
  [133, 'fc'],
  [134, 'rsvp_e2e_ignore'],
  [135, 'mobility_header'],
  [136, 'udplite'],
  [137, 'mpls_in_ip'],
  [138, 'manet'],
  [139, 'hip'],
  [140, 'shim6'],
  [141, 'wesp'],
  [142, 'rohc'],
  [240, 'pfsync'],
  [258, 'divert'],
]);
